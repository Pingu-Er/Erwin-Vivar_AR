
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Act_UR5E_KUKA/">
      
      
        <link rel="next" href="../HW2/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>ROS Basics Capstone – Turtlesim Catch Them All - Erwin-Vivar (197976)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ros-basics-capstone-turtlesim-catch-them-all" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Erwin-Vivar (197976)" class="md-header__button md-logo" aria-label="Erwin-Vivar (197976)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Erwin-Vivar (197976)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ROS Basics Capstone – Turtlesim Catch Them All
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Erwin-Vivar (197976)" class="md-nav__button md-logo" aria-label="Erwin-Vivar (197976)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Erwin-Vivar (197976)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Act_UR5E_KUKA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Forward Kinematics (UR5e and KUKA KR16)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    ROS Basics Capstone – Turtlesim Catch Them All
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    ROS Basics Capstone – Turtlesim Catch Them All
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-project-objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Project objective
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. System architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. System architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nodes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Topics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Services
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-custom-interfaces-package-er_interfaces_turtle" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Custom interfaces package (er_interfaces_turtle)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Custom interfaces package (er_interfaces_turtle)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-turtleinmsg" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 TurtleIn.msg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-turtlearraymsg" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 TurtleArray.msg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-catchturtlesrv" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 CatchTurtle.srv
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-notes-on-interface-package-build-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 Notes on interface package build files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-python-nodes-package-er_turtle" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Python nodes package (er_turtle)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-turtle_spawnerpy-spawner-alive-list-manager-catch-service-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. turtle_spawner.py (Spawner + alive list manager + catch service server)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. turtle_spawner.py (Spawner + alive list manager + catch service server)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-role-in-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Role in the system
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-main-ros-interfaces-used-by-turtle_spawner" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Main ROS interfaces used by turtle_spawner
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-important-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Important implementation details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 Important implementation details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#random-spawning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Random spawning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catch-service-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Catch service behavior
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-full-code-turtle_spawnerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5 Full code (turtle_spawner.py)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-turtle_controllerpy-chaser-controller-catch-service-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. turtle_controller.py (Chaser controller + catch service client)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. turtle_controller.py (Chaser controller + catch service client)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-role-in-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Role in the system
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-control-strategy-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Control strategy summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-discrete-pid-incremental-form-used-in-the-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 Discrete PID (incremental form) used in the code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-main-tuninglimits-in-the-uploaded-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 Main tuning/limits in the uploaded implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66-full-code-turtle_controllerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6 Full code (turtle_controller.py)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-setuppy-and-setupcfg-python-package-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. setup.py and setup.cfg (Python package registration)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. setup.py and setup.cfg (Python package registration)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-setuppy-uploaded" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 setup.py (uploaded)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-setupcfg-uploaded" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 setup.cfg (uploaded)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-bringup-package-turtle_bringup" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Bringup package (turtle_bringup)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Bringup package (turtle_bringup)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-launch-file-app_launch_turtlexml" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Launch file (app_launch_turtle.xml)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-parameter-file-t_paramyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Parameter file (t_param.yaml)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-bringup-cmakeliststxt-uploaded" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3 Bringup CMakeLists.txt (uploaded)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-how-the-full-flow-works-step-by-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. How the full flow works (step-by-step)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-useful-commands-from-assignment-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Useful commands (from assignment workflow)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Useful commands (from assignment workflow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-type-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Type inspection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-interface-structure-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Interface structure inspection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-verbose-connection-info" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3 Verbose connection info
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-terminal-and-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Terminal and results
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../HW2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    (HW2) Homework 2: Transform Nomenclature
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../HW_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    (HW1) Homework 1: Examples of robots by morphology
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../HW_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    (HW3) Homework 3: Forward Kinematics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ROS2_Custom_Interfaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    (A3) Activity 3: ROS 2 Custom Interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ROS2_Services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    (A2) Activity 2: ROS 2 Services
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ROS2_Topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    (A1) Activity 1: ROS 2 Topics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../comandos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CMDs
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejemplo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project example (WP)
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-project-objective" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Project objective
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. System architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. System architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nodes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Topics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Services
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-custom-interfaces-package-er_interfaces_turtle" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Custom interfaces package (er_interfaces_turtle)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Custom interfaces package (er_interfaces_turtle)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-turtleinmsg" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 TurtleIn.msg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-turtlearraymsg" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 TurtleArray.msg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-catchturtlesrv" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 CatchTurtle.srv
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-notes-on-interface-package-build-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 Notes on interface package build files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-python-nodes-package-er_turtle" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Python nodes package (er_turtle)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-turtle_spawnerpy-spawner-alive-list-manager-catch-service-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. turtle_spawner.py (Spawner + alive list manager + catch service server)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. turtle_spawner.py (Spawner + alive list manager + catch service server)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-role-in-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Role in the system
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-main-ros-interfaces-used-by-turtle_spawner" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Main ROS interfaces used by turtle_spawner
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-important-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Important implementation details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 Important implementation details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#random-spawning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Random spawning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catch-service-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Catch service behavior
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-full-code-turtle_spawnerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5 Full code (turtle_spawner.py)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-turtle_controllerpy-chaser-controller-catch-service-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. turtle_controller.py (Chaser controller + catch service client)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. turtle_controller.py (Chaser controller + catch service client)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-role-in-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Role in the system
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-control-strategy-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Control strategy summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-discrete-pid-incremental-form-used-in-the-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 Discrete PID (incremental form) used in the code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-main-tuninglimits-in-the-uploaded-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 Main tuning/limits in the uploaded implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66-full-code-turtle_controllerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6 Full code (turtle_controller.py)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-setuppy-and-setupcfg-python-package-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. setup.py and setup.cfg (Python package registration)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. setup.py and setup.cfg (Python package registration)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Purpose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-setuppy-uploaded" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 setup.py (uploaded)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-setupcfg-uploaded" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 setup.cfg (uploaded)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-bringup-package-turtle_bringup" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Bringup package (turtle_bringup)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Bringup package (turtle_bringup)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-launch-file-app_launch_turtlexml" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Launch file (app_launch_turtle.xml)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-parameter-file-t_paramyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Parameter file (t_param.yaml)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-bringup-cmakeliststxt-uploaded" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3 Bringup CMakeLists.txt (uploaded)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-how-the-full-flow-works-step-by-step" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. How the full flow works (step-by-step)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-useful-commands-from-assignment-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Useful commands (from assignment workflow)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Useful commands (from assignment workflow)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-type-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Type inspection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-interface-structure-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Interface structure inspection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-verbose-connection-info" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.3 Verbose connection info
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-terminal-and-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Terminal and results
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="ros-basics-capstone-turtlesim-catch-them-all">ROS Basics Capstone – Turtlesim Catch Them All</h1>
<h2 id="1-overview">1. Overview</h2>
<p>The project is a multi-node ROS 2 application where:</p>
<ul>
<li><code>turtlesim_node</code> provides the simulator and built-in services (<code>/spawn</code>, <code>/kill</code>)</li>
<li><code>turtle_spawner</code> spawns random turtles and manages the list of alive turtles</li>
<li><code>turtle_controller</code> controls <code>turtle1</code> to chase and catch turtles</li>
<li>Custom interfaces are used to share alive turtle information and request a catch action</li>
</ul>
<p>This report documents an implementation that was already completed, focusing on how each package, node, topic, and service contributes to the final behavior. The overall goal is to integrate ROS 2 basics (topics, services, custom interfaces, parameters, and launch files) in a single working application.</p>
<hr />
<h2 id="2-project-objective">2. Project objective</h2>
<p>Implement a ROS 2 system that repeatedly spawns turtles in <code>turtlesim</code> and makes <code>turtle1</code> chase them automatically until they are removed.</p>
<p>Main expected features (from the assignment instructions):
- Spawn turtles at random positions
- Publish a list of alive turtles
- Control <code>turtle1</code> using a feedback controller
- Request capture of a turtle through a custom service
- Use a launch file and YAML parameters to start the system</p>
<p>In practice, this capstone demonstrates a complete control loop:
1. Perception/state update (<code>/turtle1/pose</code>, <code>/alive_turtles</code>)
2. Decision (select nearest turtle)
3. Action (<code>/turtle1/cmd_vel</code>)
4. Task completion request (<code>/catch_turtle</code>)
5. Environment update (remove turtle and republish alive list)</p>
<hr />
<h2 id="3-system-architecture">3. System architecture</h2>
<h3 id="nodes">Nodes</h3>
<ul>
<li><code>turtlesim_node</code> (from <code>turtlesim</code>)</li>
<li><code>turtle_spawner</code> (custom, package <code>er_turtle</code>)</li>
<li><code>turtle_controller</code> (custom, package <code>er_turtle</code>)</li>
</ul>
<h3 id="topics">Topics</h3>
<ul>
<li><code>/turtle1/pose</code> (subscribe in controller)</li>
<li><code>/turtle1/cmd_vel</code> (publish from controller)</li>
<li><code>/alive_turtles</code> (publish from spawner, subscribe in controller)</li>
</ul>
<h3 id="services">Services</h3>
<ul>
<li><code>/spawn</code> (called by spawner)</li>
<li><code>/kill</code> (called by spawner)</li>
<li><code>/catch_turtle</code> (custom service offered by spawner, called by controller)</li>
</ul>
<p>This architecture separates responsibilities clearly:
- <code>turtle_spawner</code> manages the "world state" of target turtles.
- <code>turtle_controller</code> manages motion control and pursuit behavior.
- <code>turtlesim_node</code> provides the simulation and native turtle management services.</p>
<p>This separation is aligned with the assignment intent: use ROS 2 communication primitives to coordinate independent nodes.</p>
<hr />
<h2 id="4-custom-interfaces-package-er_interfaces_turtle">4. Custom interfaces package (<code>er_interfaces_turtle</code>)</h2>
<p>This package defines the messages and service used by the controller and spawner.</p>
<p>Custom interfaces are required because the default ROS 2 and turtlesim interfaces do not provide:
- a compact list of all alive turtles with positions (<code>TurtleArray</code>)
- a custom "catch request" semantic (<code>CatchTurtle</code>)</p>
<h3 id="41-turtleinmsg">4.1 <code>TurtleIn.msg</code></h3>
<p>Purpose:
- Represents a turtle entry in the alive list.
- Stores the turtle name and its spawn pose.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>string name
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>float32 x
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>float32 y
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>float32 theta
</span></code></pre></div>
<p>Explanation:
- <code>name</code>: turtle name (for example <code>turtle2</code>, <code>turtle3</code>, etc.)
- <code>x</code>, <code>y</code>: turtle position used when spawned
- <code>theta</code>: turtle heading used when spawned</p>
<p>This message is the basic unit used by the spawner to publish tracked turtles and by the controller to choose a target.</p>
<hr />
<h3 id="42-turtlearraymsg">4.2 <code>TurtleArray.msg</code></h3>
<p>Purpose:
- Publishes all currently alive turtles in one message.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>TurtleIn[] turtles
</span></code></pre></div>
<p>Explanation:
- <code>turtles</code> is an array of <code>TurtleIn</code>
- This topic is published by <code>turtle_spawner</code> and read by <code>turtle_controller</code></p>
<p>Using a single array message avoids publishing multiple topics or multiple services just to share the current list of targets. It also makes the controller logic simpler because it receives the full set of candidates in one callback.</p>
<hr />
<h3 id="43-catchturtlesrv">4.3 <code>CatchTurtle.srv</code></h3>
<p>Purpose:
- Requests that one turtle be removed (caught) by name.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>string name
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>---
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>bool success
</span></code></pre></div>
<p>Explanation:
- Request:
  - <code>name</code>: the turtle to remove
- Response:
  - <code>success</code>: whether the request was accepted and processed</p>
<p>This service acts as the bridge between "controller reached target" and "spawner updates the alive list + kills turtle in turtlesim". It keeps the controller focused on motion and the spawner focused on entity management.</p>
<hr />
<h3 id="44-notes-on-interface-package-build-files">4.4 Notes on interface package build files</h3>
<p>The interface package must use <code>rosidl_generate_interfaces(...)</code> in <code>CMakeLists.txt</code> and declare the correct dependencies in <code>package.xml</code> (<code>rosidl_default_generators</code>, <code>rosidl_default_runtime</code>, and <code>ament_cmake</code>).</p>
<p>The uploaded interface <code>package.xml</code> identifies the package as:</p>
<ul>
<li><code>er_interfaces_turtle</code></li>
</ul>
<p>This matches the imports used in the Python nodes:
- <code>from er_interfaces_turtle.msg import ...</code>
- <code>from er_interfaces_turtle.srv import ...</code></p>
<p>This consistency is important because any mismatch between package name, generated interfaces, and Python imports causes build/import errors.</p>
<hr />
<h2 id="5-python-nodes-package-er_turtle">5. Python nodes package (<code>er_turtle</code>)</h2>
<p>This package contains the two custom nodes:
- <code>turtle_spawner</code>
- <code>turtle_controller</code></p>
<p>It also includes <code>setup.py</code>/<code>setup.cfg</code> for registering executables.</p>
<p>Functionally, this package is where the runtime behavior of the capstone lives:
- one node manages target generation/removal
- the other node performs guidance and pursuit</p>
<hr />
<h2 id="5-turtle_spawnerpy-spawner-alive-list-manager-catch-service-server">5. <code>turtle_spawner.py</code> (Spawner + alive list manager + catch service server)</h2>
<h3 id="51-role-in-the-system">5.1 Role in the system</h3>
<p><code>MySpawner</code> is responsible for:
- Spawning turtles periodically at random positions using <code>/spawn</code>
- Keeping an internal list of alive turtles
- Publishing that list to <code>alive_turtles</code>
- Exposing <code>catch_turtle</code> service
- Calling <code>/kill</code> when a turtle must be removed</p>
<p>This node acts as the "world manager" for the capstone.</p>
<p>It centralizes the logical state of active targets so the controller does not need to know how turtles are created or removed internally.</p>
<hr />
<h3 id="52-main-ros-interfaces-used-by-turtle_spawner">5.2 Main ROS interfaces used by <code>turtle_spawner</code></h3>
<ul>
<li>Client: <code>spawn</code> (<code>turtlesim/srv/Spawn</code>)</li>
<li>Client: <code>kill</code> (<code>turtlesim/srv/Kill</code>)</li>
<li>Publisher: <code>alive_turtles</code> (<code>er_interfaces_turtle/msg/TurtleArray</code>)</li>
<li>Service server: <code>catch_turtle</code> (<code>er_interfaces_turtle/srv/CatchTurtle</code>)</li>
</ul>
<p>The node uses both ROS 2 service client and server roles:
- client role for interacting with <code>turtlesim</code>
- server role for receiving "catch" requests from the controller</p>
<p>This is one of the key integration points of the assignment.</p>
<hr />
<h3 id="53-important-implementation-details">5.3 Important implementation details</h3>
<h4 id="parameters">Parameters</h4>
<p>The node declares and uses:
- <code>spawn_frequency</code> (default <code>1.25</code>)
- <code>turtle_name_prefix</code> (default <code>"turtle"</code>)</p>
<p>These are later configured in the bringup YAML file.</p>
<p>This allows the node behavior to be modified without changing code:
- faster/slower spawn rate
- different naming conventions</p>
<h4 id="internal-state">Internal state</h4>
<ul>
<li><code>cnt_name</code>: starts at <code>2</code> (because <code>turtle1</code> already exists in turtlesim)</li>
<li><code>alive_turtlesA</code>: stores the published alive turtle array</li>
</ul>
<p>Starting at <code>2</code> is important because <code>turtlesim_node</code> creates <code>turtle1</code> automatically, and the spawned turtles are intended to be targets (<code>turtle2</code>, <code>turtle3</code>, ...).</p>
<h4 id="random-spawning">Random spawning</h4>
<p>The node generates:
- <code>x</code> in <code>[0.5, 10.5]</code>
- <code>y</code> in <code>[0.5, 10.5]</code>
- <code>theta</code> in <code>[-pi, pi]</code></p>
<p>These ranges keep spawned turtles inside the visible map region and produce random headings for variety.</p>
<h4 id="catch-service-behavior">Catch service behavior</h4>
<p>When <code>catch_turtle</code> is called:
- It calls <code>/kill</code> using the received turtle name
- Removes the turtle from the internal alive list
- Republishes the updated <code>alive_turtles</code> message</p>
<p>Republishing after removal is essential so the controller always works with the current list and can immediately choose a new nearest target.</p>
<hr />
<h3 id="55-full-code-turtle_spawnerpy">5.5 Full code (<code>turtle_spawner.py</code>)</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rclpy</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rclpy.node</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">er_interfaces_turtle.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">TurtleIn</span><span class="p">,</span> <span class="n">TurtleArray</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">er_interfaces_turtle.srv</span><span class="w"> </span><span class="kn">import</span> <span class="n">CatchTurtle</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">turtlesim.srv</span><span class="w"> </span><span class="kn">import</span> <span class="n">Spawn</span><span class="p">,</span> <span class="n">Kill</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">MySpawner</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;turtle_spawner&quot;</span><span class="p">)</span> <span class="c1">#Only identification          </span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Spawn</span><span class="p">,</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span> <span class="c1">#Service type, Service name</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s2">&quot;spawn_frequency&quot;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">)</span> <span class="c1">#Declare parameter</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spawn_frequency_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;spawn_frequency&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="c1">#Use the parameter</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spawn_frequency_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_spawner</span><span class="p">)</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">declare_parameter</span><span class="p">(</span><span class="s2">&quot;turtle_name_prefix&quot;</span><span class="p">,</span> <span class="s2">&quot;turtle&quot;</span><span class="p">)</span> <span class="c1">#Declare parameter</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_name_prefix_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;turtle_name_prefix&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="c1">#Use the parameter</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cnt_name</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alive_turtlesA</span> <span class="o">=</span> <span class="n">TurtleArray</span><span class="p">()</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alive_turtles_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">TurtleArray</span><span class="p">,</span> <span class="s2">&quot;alive_turtles&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">catch_turtle_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_service</span><span class="p">(</span><span class="n">CatchTurtle</span><span class="p">,</span> <span class="s2">&quot;catch_turtle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_kill</span><span class="p">)</span> <span class="c1">#Service type, Service name, callback</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Kill</span><span class="p">,</span> <span class="s2">&quot;kill&quot;</span><span class="p">)</span> <span class="c1">#Service type, Service name</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="n">TurtleIn</span><span class="p">):</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">timeout_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server not available&quot;</span><span class="p">)</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>        <span class="n">request</span> <span class="o">=</span> <span class="n">Spawn</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>        <span class="n">request</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">save</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>        <span class="n">request</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">save</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>        <span class="n">request</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">save</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>        <span class="n">request</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">save</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>        <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>        <span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_spawn</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">save</span><span class="p">))</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>            <span class="n">save</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alive_turtlesA</span><span class="o">.</span><span class="n">turtles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alive_turtles_</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_turtlesA</span><span class="p">)</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spawned requested=&#39;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; returned=&#39;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spawn failed for </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">t_spawner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>        <span class="n">save</span> <span class="o">=</span> <span class="n">TurtleIn</span><span class="p">()</span>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>        <span class="n">save</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_name_prefix_</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnt_name</span><span class="p">)</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>        <span class="n">save</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">))</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>        <span class="n">save</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">))</span>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>        <span class="n">save</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">call_spawn</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cnt_name</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">kill_la_kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client2</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">timeout_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server not available&quot;</span><span class="p">)</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>        <span class="n">request</span> <span class="o">=</span> <span class="n">Kill</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>        <span class="n">request</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client2</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_kill</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a>
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Kill</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>
</span><span id="__span-3-79"><a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-3-80"><a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>            <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-3-81"><a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>
</span><span id="__span-3-82"><a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_alive_turtle</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
</span><span id="__span-3-83"><a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">alive_turtles_</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_turtlesA</span><span class="p">)</span>
</span><span id="__span-3-84"><a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>
</span><span id="__span-3-85"><a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kill: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-86"><a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-3-87"><a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kill failed for </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-88"><a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>
</span><span id="__span-3-89"><a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_alive_turtle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-3-90"><a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alive_turtlesA</span><span class="o">.</span><span class="n">turtles</span><span class="p">):</span>
</span><span id="__span-3-91"><a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a>            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
</span><span id="__span-3-92"><a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive_turtlesA</span><span class="o">.</span><span class="n">turtles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-3-93"><a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-3-94"><a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-3-95"><a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>
</span><span id="__span-3-96"><a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">call_kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">CatchTurtle</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">CatchTurtle</span><span class="o">.</span><span class="n">Response</span><span class="p">):</span>
</span><span id="__span-3-97"><a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kill_la_kill</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-3-98"><a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a>        <span class="n">response</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-3-99"><a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S= </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-3-100"><a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>        <span class="k">return</span> <span class="n">response</span>
</span><span id="__span-3-101"><a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>
</span><span id="__span-3-102"><a id="__codelineno-3-102" name="__codelineno-3-102" href="#__codelineno-3-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-3-103"><a id="__codelineno-3-103" name="__codelineno-3-103" href="#__codelineno-3-103"></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>   
</span><span id="__span-3-104"><a id="__codelineno-3-104" name="__codelineno-3-104" href="#__codelineno-3-104"></a>    <span class="n">node</span> <span class="o">=</span> <span class="n">MySpawner</span><span class="p">()</span>
</span><span id="__span-3-105"><a id="__codelineno-3-105" name="__codelineno-3-105" href="#__codelineno-3-105"></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> 
</span><span id="__span-3-106"><a id="__codelineno-3-106" name="__codelineno-3-106" href="#__codelineno-3-106"></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-3-107"><a id="__codelineno-3-107" name="__codelineno-3-107" href="#__codelineno-3-107"></a>
</span><span id="__span-3-108"><a id="__codelineno-3-108" name="__codelineno-3-108" href="#__codelineno-3-108"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>  
</span><span id="__span-3-109"><a id="__codelineno-3-109" name="__codelineno-3-109" href="#__codelineno-3-109"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<hr />
<h2 id="6-turtle_controllerpy-chaser-controller-catch-service-client">6. <code>turtle_controller.py</code> (Chaser controller + catch service client)</h2>
<h3 id="61-role-in-the-system">6.1 Role in the system</h3>
<p><code>TurtlePointController</code>:
- Reads <code>turtle1</code> pose from <code>turtle1/pose</code>
- Reads alive turtles from <code>alive_turtles</code>
- Chooses the nearest turtle as target
- Computes control commands (<code>linear.x</code>, <code>angular.z</code>) to chase it
- Calls <code>catch_turtle</code> when the target is reached</p>
<p>This is the intelligent behavior node of the capstone.</p>
<p>Its main responsibility is not spawning or deleting turtles, but generating motion commands that make <code>turtle1</code> converge to the active target robustly and repeatedly.</p>
<hr />
<h3 id="62-control-strategy-summary">6.2 Control strategy summary</h3>
<p>The controller uses:</p>
<ul>
<li>A <strong>discrete incremental PID</strong> for linear speed (distance error)</li>
<li>A <strong>discrete incremental PID</strong> for angular speed (heading error)</li>
<li>Saturation/anti-windup-style clipping for command limits</li>
<li>Angle wrapping to keep angular error in <code>[-pi, pi]</code></li>
<li>A cosine coupling term to reduce orbiting/loops</li>
</ul>
<p>Control variables:
- Distance error: <code>distance = sqrt((gx-x)^2 + (gy-y)^2)</code>
- Angular error: <code>alpha = wrap_pi(goal_angle - theta)</code></p>
<p>A goal is considered reached when:
- <code>distance &lt;= pos_tol</code></p>
<p>At that moment:
- The controller publishes zero velocity
- Resets PID memory
- Calls <code>catch_turtle</code> for the selected turtle name</p>
<p>This behavior matches the assignment goal of autonomous pursuit-and-catch using ROS communication and feedback control.</p>
<hr />
<h3 id="63-discrete-pid-incremental-form-used-in-the-code">6.3 Discrete PID (incremental form) used in the code</h3>
<p>The implementation is based on an incremental discrete PID form (as coded in <code>IncPid.step()</code>):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>u[k] = u[k-1] + q0*e[k] + q1*e[k-1] + q2*e[k-2]
</span></code></pre></div>
<p>Where:
- <code>u[k]</code> is the current control output
- <code>e[k]</code> is the current error
- <code>q0</code>, <code>q1</code>, <code>q2</code> are coefficients computed from continuous parameters (<code>kc</code>, <code>ti</code>, <code>td</code>) and sample time <code>Ts</code></p>
<p>The code computes coefficients in <code>set_from_continuous(...)</code> and applies clipping with <code>clip_value(...)</code>.</p>
<p>In this implementation:
- one PID instance (<code>self.v_pid</code>) regulates the distance error and generates the linear speed reference
- another PID instance (<code>self.w_pid</code>) regulates the heading error and generates the angular speed command</p>
<p>Additionally, the linear command is multiplied by a cosine term based on <code>alpha</code>, which reduces forward motion when the turtle is not facing the target. This improves turning behavior and reduces circular trajectories around the goal.</p>
<p><img alt="Terminal A screenshot" src="../recursos/imgs/Act_turtle/tabla.jpg" /></p>
<hr />
<h3 id="64-main-tuninglimits-in-the-uploaded-implementation">6.4 Main tuning/limits in the uploaded implementation</h3>
<ul>
<li>Sample time: <code>Ts = 0.05 s</code></li>
<li>Position tolerance: <code>0.275</code></li>
<li>Linear command limits: <code>[-12.0, 12.0]</code></li>
<li>Angular command limits: <code>[-7.5, 7.5]</code></li>
</ul>
<p>Tuned PID values used in code:
- Linear PID: <code>kc=2.25</code>, <code>ti=0.985</code>, <code>td=0.0275</code>
- Angular PID: <code>kc=3.6</code>, <code>ti=0.65</code>, <code>td=0.0245</code></p>
<p>These values define the response speed and smoothness of the pursuit behavior. The command limits are especially important in <code>turtlesim</code> to prevent excessive velocities that could make the trajectory unstable or visually erratic.</p>
<hr />
<h3 id="66-full-code-turtle_controllerpy">6.6 Full code (<code>turtle_controller.py</code>)</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rclpy</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">rclpy.node</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">geometry_msgs.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">Twist</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">turtlesim.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pose</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">er_interfaces_turtle.msg</span><span class="w"> </span><span class="kn">import</span> <span class="n">TurtleArray</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">er_interfaces_turtle.srv</span><span class="w"> </span><span class="kn">import</span> <span class="n">CatchTurtle</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="c1">#Anti-windup/limits</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">clip_value</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="c1">#Wrap for fast response</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap_pi</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="n">angle</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">IncPid</span><span class="p">:</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">umin</span><span class="p">,</span> <span class="n">umax</span><span class="p">):</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">umin</span> <span class="o">=</span> <span class="n">umin</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">umax</span> <span class="o">=</span> <span class="n">umax</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>        <span class="c1">#Sample important states</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="mf">0.0</span>   <span class="c1"># e[k-1]</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="mf">0.0</span>   <span class="c1"># e[k-2]</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="mf">0.0</span>   <span class="c1"># u[k-1]</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>        <span class="c1">#Discrete coefficients</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q2</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_from_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">td</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>        <span class="n">Ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>        <span class="n">i_term</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>        <span class="k">if</span> <span class="n">ti</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ti</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>            <span class="n">i_term</span> <span class="o">=</span> <span class="n">Ts</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>        <span class="n">d_term</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>        <span class="k">if</span> <span class="n">td</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>            <span class="n">d_term</span> <span class="o">=</span> <span class="n">td</span> <span class="o">/</span> <span class="n">Ts</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>        <span class="c1">#Incremental PID coefficient (discrete)</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">=</span> <span class="n">kc</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">i_term</span> <span class="o">+</span> <span class="n">d_term</span><span class="p">)</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q1</span> <span class="o">=</span> <span class="o">-</span><span class="n">kc</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">i_term</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_term</span><span class="p">)</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">q2</span> <span class="o">=</span> <span class="n">kc</span> <span class="o">*</span> <span class="n">d_term</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">clip_value</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">umin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">)</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">q0</span> <span class="o">*</span> <span class="n">e</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">q1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">q2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">clip_value</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">umin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">)</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>        <span class="c1">#Update past</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a><span class="k">class</span><span class="w"> </span><span class="nc">TurtlePointController</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;turtle_controller&quot;</span><span class="p">)</span>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>        <span class="c1"># ===== Sample time =====</span>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="mf">0.05</span>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a>        <span class="c1"># ===== Tolerances =====</span>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_tol</span> <span class="o">=</span> <span class="mf">0.275</span>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">allow_reverse</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#My experiment, it is good for slow responses (kinda funny)</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a>
</span><span id="__span-5-79"><a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a>        <span class="c1"># ===== Command limits =====</span>
</span><span id="__span-5-80"><a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">v_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">12.0</span>
</span><span id="__span-5-81"><a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">v_max</span> <span class="o">=</span>  <span class="mf">12.0</span>
</span><span id="__span-5-82"><a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.5</span>
</span><span id="__span-5-83"><a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span> <span class="o">=</span>  <span class="mf">7.5</span>
</span><span id="__span-5-84"><a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a>
</span><span id="__span-5-85"><a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a>        <span class="c1"># ===== Linear PID (distance) =====</span>
</span><span id="__span-5-86"><a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">v_pid</span> <span class="o">=</span> <span class="n">IncPid</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">umin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v_min</span><span class="p">,</span> <span class="n">umax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v_max</span><span class="p">)</span>
</span><span id="__span-5-87"><a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">v_pid</span><span class="o">.</span><span class="n">set_from_continuous</span><span class="p">(</span><span class="n">kc</span><span class="o">=</span><span class="mf">2.25</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="mf">0.985</span><span class="p">,</span> <span class="n">td</span><span class="o">=</span><span class="mf">0.0275</span><span class="p">)</span>
</span><span id="__span-5-88"><a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a>
</span><span id="__span-5-89"><a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a>        <span class="c1"># ===== Angular PID (alpha) =====</span>
</span><span id="__span-5-90"><a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w_pid</span> <span class="o">=</span> <span class="n">IncPid</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">umin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w_min</span><span class="p">,</span> <span class="n">umax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">)</span>
</span><span id="__span-5-91"><a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w_pid</span><span class="o">.</span><span class="n">set_from_continuous</span><span class="p">(</span><span class="n">kc</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">td</span><span class="o">=</span><span class="mf">0.0245</span><span class="p">)</span>
</span><span id="__span-5-92"><a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a>
</span><span id="__span-5-93"><a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a>        <span class="c1"># ===== Current pose =====</span>
</span><span id="__span-5-94"><a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-95"><a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-96"><a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-97"><a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pose_ok</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#Not necessary but just to be sure</span>
</span><span id="__span-5-98"><a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>
</span><span id="__span-5-99"><a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a>        <span class="c1"># ===== Goal point =====</span>
</span><span id="__span-5-100"><a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gx</span> <span class="o">=</span> <span class="mf">5.4444</span>
</span><span id="__span-5-101"><a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gy</span> <span class="o">=</span> <span class="mf">5.4444</span>
</span><span id="__span-5-102"><a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">goal_ok</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#Not necessary but just to be sure</span>
</span><span id="__span-5-103"><a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_goal</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gy</span><span class="p">)</span>
</span><span id="__span-5-104"><a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a>
</span><span id="__span-5-105"><a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a>        <span class="c1"># ===== Current errors =====</span>
</span><span id="__span-5-106"><a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1">#Distance error</span>
</span><span id="__span-5-107"><a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1">#Orientation error</span>
</span><span id="__span-5-108"><a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>
</span><span id="__span-5-109"><a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>        <span class="c1"># ===== NAME =====</span>
</span><span id="__span-5-110"><a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name_kill</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-5-111"><a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>
</span><span id="__span-5-112"><a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a>        <span class="c1"># ===== ROS interfaces =====</span>
</span><span id="__span-5-113"><a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">Twist</span><span class="p">,</span> <span class="s2">&quot;turtle1/cmd_vel&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-5-114"><a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_step</span><span class="p">)</span>        
</span><span id="__span-5-115"><a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>
</span><span id="__span-5-116"><a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">Pose</span><span class="p">,</span> <span class="s2">&quot;turtle1/pose&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pose_cb</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-5-117"><a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">TurtleArray</span><span class="p">,</span> <span class="s2">&quot;alive_turtles&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_cb</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">#Will be modified</span>
</span><span id="__span-5-118"><a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>
</span><span id="__span-5-119"><a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">CatchTurtle</span><span class="p">,</span><span class="s2">&quot;catch_turtle&quot;</span><span class="p">)</span>
</span><span id="__span-5-120"><a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_kill</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-5-121"><a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>
</span><span id="__span-5-122"><a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-5-123"><a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;turtle_controller is alive&quot;</span><span class="p">)</span>
</span><span id="__span-5-124"><a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>
</span><span id="__span-5-125"><a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>
</span><span id="__span-5-126"><a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">callKILL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-5-127"><a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">timeout_sec</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-5-128"><a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server not available&quot;</span><span class="p">)</span>
</span><span id="__span-5-129"><a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>
</span><span id="__span-5-130"><a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>        <span class="n">request</span> <span class="o">=</span> <span class="n">CatchTurtle</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
</span><span id="__span-5-131"><a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>        <span class="n">request</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="__span-5-132"><a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>
</span><span id="__span-5-133"><a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>   <span class="c1">#asyncronous request</span>
</span><span id="__span-5-134"><a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_callKILL</span><span class="p">,</span> <span class="n">request</span><span class="p">))</span>
</span><span id="__span-5-135"><a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>
</span><span id="__span-5-136"><a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_callKILL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">CatchTurtle</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">future</span><span class="p">):</span>
</span><span id="__span-5-137"><a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-5-138"><a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s2"> name=</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-5-139"><a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>
</span><span id="__span-5-140"><a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>
</span><span id="__span-5-141"><a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">pose_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Pose</span><span class="p">):</span>
</span><span id="__span-5-142"><a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-5-143"><a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-5-144"><a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="__span-5-145"><a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pose_ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-5-146"><a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>
</span><span id="__span-5-147"><a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">goal_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">TurtleArray</span><span class="p">):</span>
</span><span id="__span-5-148"><a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>        <span class="c1">#No turtles</span>
</span><span id="__span-5-149"><a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="o">.</span><span class="n">turtles</span><span class="p">:</span>
</span><span id="__span-5-150"><a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>            <span class="k">return</span>
</span><span id="__span-5-151"><a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>
</span><span id="__span-5-152"><a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>        <span class="c1">#Just in case, autodestruction</span>
</span><span id="__span-5-153"><a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pose_ok</span><span class="p">:</span>
</span><span id="__span-5-154"><a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>            <span class="k">return</span>
</span><span id="__span-5-155"><a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>
</span><span id="__span-5-156"><a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>        <span class="n">nearest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">turtles</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-5-157"><a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>
</span><span id="__span-5-158"><a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name_kill</span> <span class="o">=</span> <span class="n">nearest</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-5-159"><a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>        <span class="n">new_goal</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nearest</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nearest</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</span><span id="__span-5-160"><a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gy</span> <span class="o">=</span> <span class="n">new_goal</span>
</span><span id="__span-5-161"><a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">goal_ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-5-162"><a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a>
</span><span id="__span-5-163"><a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>        <span class="c1">#Reset PID memory if goal changed noticeably (fast response)</span>
</span><span id="__span-5-164"><a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="n">new_goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-5-165"><a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a>        <span class="n">dy</span> <span class="o">=</span> <span class="n">new_goal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_goal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-5-166"><a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a>        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span id="__span-5-167"><a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">v_pid</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-5-168"><a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">w_pid</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-5-169"><a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>
</span><span id="__span-5-170"><a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_goal</span> <span class="o">=</span> <span class="n">new_goal</span>
</span><span id="__span-5-171"><a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a>
</span><span id="__span-5-172"><a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-173"><a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a>        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
</span><span id="__span-5-174"><a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
</span><span id="__span-5-175"><a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a>
</span><span id="__span-5-176"><a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">))</span>
</span><span id="__span-5-177"><a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>
</span><span id="__span-5-178"><a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_tol</span><span class="p">:</span>
</span><span id="__span-5-179"><a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-180"><a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a>            <span class="k">return</span>
</span><span id="__span-5-181"><a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a>
</span><span id="__span-5-182"><a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>        <span class="n">goal_angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">))</span>
</span><span id="__span-5-183"><a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">wrap_pi</span><span class="p">(</span><span class="n">goal_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="__span-5-184"><a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a>
</span><span id="__span-5-185"><a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">publish_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-186"><a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
</span><span id="__span-5-187"><a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-188"><a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-5-189"><a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-5-190"><a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>
</span><span id="__span-5-191"><a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">control_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-5-192"><a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pose_ok</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_ok</span><span class="p">:</span>
</span><span id="__span-5-193"><a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>            <span class="k">return</span>
</span><span id="__span-5-194"><a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>
</span><span id="__span-5-195"><a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_errors</span><span class="p">()</span>
</span><span id="__span-5-196"><a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>
</span><span id="__span-5-197"><a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a>        <span class="c1">#Stop condition (point reached)</span>
</span><span id="__span-5-198"><a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_tol</span><span class="p">:</span>
</span><span id="__span-5-199"><a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">publish_stop</span><span class="p">()</span>
</span><span id="__span-5-200"><a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">v_pid</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-5-201"><a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">w_pid</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-5-202"><a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_kill</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_kill</span><span class="p">:</span>
</span><span id="__span-5-203"><a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">callKILL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_kill</span><span class="p">)</span>
</span><span id="__span-5-204"><a id="__codelineno-5-204" name="__codelineno-5-204" href="#__codelineno-5-204"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">last_kill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_kill</span>
</span><span id="__span-5-205"><a id="__codelineno-5-205" name="__codelineno-5-205" href="#__codelineno-5-205"></a>            <span class="k">return</span>
</span><span id="__span-5-206"><a id="__codelineno-5-206" name="__codelineno-5-206" href="#__codelineno-5-206"></a>
</span><span id="__span-5-207"><a id="__codelineno-5-207" name="__codelineno-5-207" href="#__codelineno-5-207"></a>        <span class="c1">#Angular command</span>
</span><span id="__span-5-208"><a id="__codelineno-5-208" name="__codelineno-5-208" href="#__codelineno-5-208"></a>        <span class="n">w_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_pid</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="__span-5-209"><a id="__codelineno-5-209" name="__codelineno-5-209" href="#__codelineno-5-209"></a>
</span><span id="__span-5-210"><a id="__codelineno-5-210" name="__codelineno-5-210" href="#__codelineno-5-210"></a>        <span class="c1">#Linear command from distance PID</span>
</span><span id="__span-5-211"><a id="__codelineno-5-211" name="__codelineno-5-211" href="#__codelineno-5-211"></a>        <span class="n">v_pid_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_pid</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
</span><span id="__span-5-212"><a id="__codelineno-5-212" name="__codelineno-5-212" href="#__codelineno-5-212"></a>
</span><span id="__span-5-213"><a id="__codelineno-5-213" name="__codelineno-5-213" href="#__codelineno-5-213"></a>        <span class="c1">#Coupling to reduce loops/orbits:</span>
</span><span id="__span-5-214"><a id="__codelineno-5-214" name="__codelineno-5-214" href="#__codelineno-5-214"></a>        <span class="c1">#linear speed decreases if heading error is large</span>
</span><span id="__span-5-215"><a id="__codelineno-5-215" name="__codelineno-5-215" href="#__codelineno-5-215"></a>        <span class="n">c</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">))</span>
</span><span id="__span-5-216"><a id="__codelineno-5-216" name="__codelineno-5-216" href="#__codelineno-5-216"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_reverse</span><span class="p">:</span>
</span><span id="__span-5-217"><a id="__codelineno-5-217" name="__codelineno-5-217" href="#__codelineno-5-217"></a>            <span class="n">v_cmd</span> <span class="o">=</span> <span class="n">v_pid_out</span> <span class="o">*</span> <span class="n">c</span>
</span><span id="__span-5-218"><a id="__codelineno-5-218" name="__codelineno-5-218" href="#__codelineno-5-218"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-219"><a id="__codelineno-5-219" name="__codelineno-5-219" href="#__codelineno-5-219"></a>            <span class="n">v_cmd</span> <span class="o">=</span> <span class="n">v_pid_out</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span><span id="__span-5-220"><a id="__codelineno-5-220" name="__codelineno-5-220" href="#__codelineno-5-220"></a>
</span><span id="__span-5-221"><a id="__codelineno-5-221" name="__codelineno-5-221" href="#__codelineno-5-221"></a>        <span class="c1"># Final clamp (after coupling)</span>
</span><span id="__span-5-222"><a id="__codelineno-5-222" name="__codelineno-5-222" href="#__codelineno-5-222"></a>        <span class="n">v_cmd</span> <span class="o">=</span> <span class="n">clip_value</span><span class="p">(</span><span class="n">v_cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_max</span><span class="p">)</span>
</span><span id="__span-5-223"><a id="__codelineno-5-223" name="__codelineno-5-223" href="#__codelineno-5-223"></a>        <span class="n">w_cmd</span> <span class="o">=</span> <span class="n">clip_value</span><span class="p">(</span><span class="n">w_cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_max</span><span class="p">)</span>
</span><span id="__span-5-224"><a id="__codelineno-5-224" name="__codelineno-5-224" href="#__codelineno-5-224"></a>
</span><span id="__span-5-225"><a id="__codelineno-5-225" name="__codelineno-5-225" href="#__codelineno-5-225"></a>        <span class="c1"># Publish</span>
</span><span id="__span-5-226"><a id="__codelineno-5-226" name="__codelineno-5-226" href="#__codelineno-5-226"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
</span><span id="__span-5-227"><a id="__codelineno-5-227" name="__codelineno-5-227" href="#__codelineno-5-227"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v_cmd</span><span class="p">)</span>
</span><span id="__span-5-228"><a id="__codelineno-5-228" name="__codelineno-5-228" href="#__codelineno-5-228"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_cmd</span><span class="p">)</span>
</span><span id="__span-5-229"><a id="__codelineno-5-229" name="__codelineno-5-229" href="#__codelineno-5-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-5-230"><a id="__codelineno-5-230" name="__codelineno-5-230" href="#__codelineno-5-230"></a>
</span><span id="__span-5-231"><a id="__codelineno-5-231" name="__codelineno-5-231" href="#__codelineno-5-231"></a>        <span class="c1"># Debug (every ~0.5 s)</span>
</span><span id="__span-5-232"><a id="__codelineno-5-232" name="__codelineno-5-232" href="#__codelineno-5-232"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-5-233"><a id="__codelineno-5-233" name="__codelineno-5-233" href="#__codelineno-5-233"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_counter</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-5-234"><a id="__codelineno-5-234" name="__codelineno-5-234" href="#__codelineno-5-234"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-5-235"><a id="__codelineno-5-235" name="__codelineno-5-235" href="#__codelineno-5-235"></a>                <span class="sa">f</span><span class="s2">&quot;distance=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> alpha=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="__span-5-236"><a id="__codelineno-5-236" name="__codelineno-5-236" href="#__codelineno-5-236"></a>                <span class="sa">f</span><span class="s2">&quot;v=</span><span class="si">{</span><span class="n">v_cmd</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> w=</span><span class="si">{</span><span class="n">w_cmd</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="__span-5-237"><a id="__codelineno-5-237" name="__codelineno-5-237" href="#__codelineno-5-237"></a>                <span class="sa">f</span><span class="s2">&quot;goal=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gx</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="__span-5-238"><a id="__codelineno-5-238" name="__codelineno-5-238" href="#__codelineno-5-238"></a>                <span class="sa">f</span><span class="s2">&quot;pose=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="__span-5-239"><a id="__codelineno-5-239" name="__codelineno-5-239" href="#__codelineno-5-239"></a>            <span class="p">)</span>
</span><span id="__span-5-240"><a id="__codelineno-5-240" name="__codelineno-5-240" href="#__codelineno-5-240"></a>
</span><span id="__span-5-241"><a id="__codelineno-5-241" name="__codelineno-5-241" href="#__codelineno-5-241"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-5-242"><a id="__codelineno-5-242" name="__codelineno-5-242" href="#__codelineno-5-242"></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-5-243"><a id="__codelineno-5-243" name="__codelineno-5-243" href="#__codelineno-5-243"></a>    <span class="n">node</span> <span class="o">=</span> <span class="n">TurtlePointController</span><span class="p">()</span>
</span><span id="__span-5-244"><a id="__codelineno-5-244" name="__codelineno-5-244" href="#__codelineno-5-244"></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="__span-5-245"><a id="__codelineno-5-245" name="__codelineno-5-245" href="#__codelineno-5-245"></a>    <span class="n">rclpy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-5-246"><a id="__codelineno-5-246" name="__codelineno-5-246" href="#__codelineno-5-246"></a>
</span><span id="__span-5-247"><a id="__codelineno-5-247" name="__codelineno-5-247" href="#__codelineno-5-247"></a>
</span><span id="__span-5-248"><a id="__codelineno-5-248" name="__codelineno-5-248" href="#__codelineno-5-248"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-5-249"><a id="__codelineno-5-249" name="__codelineno-5-249" href="#__codelineno-5-249"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<hr />
<h2 id="7-setuppy-and-setupcfg-python-package-registration">7. <code>setup.py</code> and <code>setup.cfg</code> (Python package registration)</h2>
<h3 id="71-purpose">7.1 Purpose</h3>
<p>These files register the executable entry points so ROS 2 can run the Python nodes using:</p>
<ul>
<li><code>ros2 run er_turtle turtle_spawner</code></li>
<li><code>ros2 run er_turtle turtle_controller</code></li>
</ul>
<p>This is required for <code>ament_python</code> packages because ROS 2 resolves executable names through the <code>console_scripts</code> declared in <code>setup.py</code>.</p>
<h3 id="72-setuppy-uploaded">7.2 <code>setup.py</code> (uploaded)</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">setuptools</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_packages</span><span class="p">,</span> <span class="n">setup</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;er_turtle&#39;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">setup</span><span class="p">(</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">name</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0.0&#39;</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]),</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="p">(</span><span class="s1">&#39;share/ament_index/resource_index/packages&#39;</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            <span class="p">[</span><span class="s1">&#39;resource/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">]),</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="p">(</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;package.xml&#39;</span><span class="p">]),</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="p">],</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;setuptools&#39;</span><span class="p">],</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="n">zip_safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="n">maintainer</span><span class="o">=</span><span class="s1">&#39;pingu&#39;</span><span class="p">,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="n">maintainer_email</span><span class="o">=</span><span class="s1">&#39;pingu@todo.todo&#39;</span><span class="p">,</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;TODO: Package description&#39;</span><span class="p">,</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    <span class="n">license</span><span class="o">=</span><span class="s1">&#39;TODO: License declaration&#39;</span><span class="p">,</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>        <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>            <span class="s1">&#39;pytest&#39;</span><span class="p">,</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>        <span class="p">],</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    <span class="p">},</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>            <span class="s1">&#39;turtle_controller2 = er_turtle.turtle_controller2:main&#39;</span><span class="p">,</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>            <span class="s1">&#39;turtle_controller = er_turtle.turtle_controller:main&#39;</span><span class="p">,</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>            <span class="s1">&#39;turtle_spawner = er_turtle.turtle_spawner:main&#39;</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>        <span class="p">],</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>    <span class="p">},</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="p">)</span>
</span></code></pre></div>
<h3 id="73-setupcfg-uploaded">7.3 <code>setup.cfg</code> (uploaded)</h3>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">[develop]</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="na">script_dir</span><span class="o">=</span><span class="s">$base/lib/er_turtle</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">[install]</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="na">install_scripts</span><span class="o">=</span><span class="s">$base/lib/er_turtle</span>
</span></code></pre></div>
<h3 id="74-notes">7.4 Notes</h3>
<ul>
<li>The uploaded <code>setup.py</code> includes an extra entry point:</li>
<li><code>turtle_controller2 = er_turtle.turtle_controller2:main</code></li>
<li>If <code>turtle_controller2.py</code> does not exist, that entry point should be removed to avoid runtime errors.</li>
</ul>
<p>For the capstone workflow, the important part is that <code>turtle_spawner</code> and <code>turtle_controller</code> are correctly registered, since both are referenced by the launch file.</p>
<hr />
<h2 id="8-bringup-package-turtle_bringup">8. Bringup package (<code>turtle_bringup</code>)</h2>
<p>The bringup package starts the complete application and provides parameters for <code>turtle_spawner</code>.</p>
<p>Using a dedicated bringup package is good practice because it keeps:
- executable node code in one package (<code>er_turtle</code>)
- custom interfaces in another (<code>er_interfaces_turtle</code>)
- system startup/configuration files in a separate package (<code>turtle_bringup</code>)</p>
<p>This improves organization and makes the system easier to reuse and test.</p>
<hr />
<h3 id="81-launch-file-app_launch_turtlexml">8.1 Launch file (<code>app_launch_turtle.xml</code>)</h3>
<p>Purpose:
- Starts <code>turtlesim_node</code>
- Starts <code>turtle_spawner</code> and loads parameters from YAML
- Starts <code>turtle_controller</code></p>
<p>This file is the entry point for running the full demo in one command, which is one of the key expected outcomes of the capstone.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">&lt;launch&gt;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;turtlesim&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;turtlesim_node&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;er_turtle&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;turtle_spawner&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">from=</span><span class="s">&quot;$(find-pkg-share turtle_bringup)/config/t_param.yaml&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="nt">&lt;/node&gt;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;er_turtle&quot;</span><span class="w"> </span><span class="na">exec=</span><span class="s">&quot;turtle_controller&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="nt">&lt;/launch&gt;</span>
</span></code></pre></div>
<hr />
<h3 id="82-parameter-file-t_paramyaml">8.2 Parameter file (<code>t_param.yaml</code>)</h3>
<p>Purpose:
- Configures <code>turtle_spawner</code> parameters from a centralized YAML file</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">turtle_spawner</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="nt">ros__parameters</span><span class="p">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="nt">spawn_frequency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.25</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="nt">turtle_name_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;turtle&quot;</span>
</span></code></pre></div>
<p>Explanation:
- <code>spawn_frequency</code>: timer period in seconds for spawning new turtles
- <code>turtle_name_prefix</code>: prefix for generated names (<code>turtle2</code>, <code>turtle3</code>, ...)</p>
<p>This keeps runtime tuning outside the source code and matches the assignment requirement of using parameters in a realistic ROS 2 setup.</p>
<hr />
<h3 id="83-bringup-cmakeliststxt-uploaded">8.3 Bringup <code>CMakeLists.txt</code> (uploaded)</h3>
<p>Purpose:
- Installs the <code>launch/</code> and <code>config/</code> directories into the package share directory</p>
<p>This installation step is necessary so ROS 2 can find:
- <code>app_launch_turtle.xml</code>
- <code>t_param.yaml</code></p>
<p>when executing <code>ros2 launch turtle_bringup app_launch_turtle.xml</code>.</p>
<div class="language-cmake highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.8</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">project</span><span class="p">(</span><span class="s">turtle_bringup</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nb">if</span><span class="p">(</span><span class="s">CMAKE_COMPILER_IS_GNUCXX</span><span class="w"> </span><span class="s">OR</span><span class="w"> </span><span class="s">CMAKE_CXX_COMPILER_ID</span><span class="w"> </span><span class="s">MATCHES</span><span class="w"> </span><span class="s2">&quot;Clang&quot;</span><span class="p">)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="nb">add_compile_options</span><span class="p">(</span><span class="s">-Wall</span><span class="w"> </span><span class="s">-Wextra</span><span class="w"> </span><span class="s">-Wpedantic</span><span class="p">)</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nb">endif</span><span class="p">()</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="nb">install</span><span class="p">(</span><span class="s">DIRECTORY</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="s">launch</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">  </span><span class="s">config</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">share/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">/</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="p">)</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="nb">ament_package</span><span class="p">()</span>
</span></code></pre></div>
<hr />
<h2 id="9-how-the-full-flow-works-step-by-step">9. How the full flow works (step-by-step)</h2>
<ol>
<li><code>app_launch_turtle.xml</code> starts <code>turtlesim_node</code>, <code>turtle_spawner</code>, and <code>turtle_controller</code>.</li>
<li><code>turtle_spawner</code> uses the YAML parameters to set spawn period and name prefix.</li>
<li><code>turtle_spawner</code> periodically calls <code>/spawn</code> with random <code>(x, y, theta)</code>.</li>
<li>Every successful spawn is added to the internal <code>alive_turtles</code> list and published.</li>
<li><code>turtle_controller</code> receives <code>/alive_turtles</code>, selects the nearest turtle as current target.</li>
<li><code>turtle_controller</code> reads <code>/turtle1/pose</code> and computes velocity commands using the discrete PID logic.</li>
<li>When <code>turtle1</code> reaches the target (inside <code>pos_tol</code>), <code>turtle_controller</code> calls <code>catch_turtle</code>.</li>
<li><code>turtle_spawner</code> receives <code>catch_turtle</code>, calls <code>/kill</code>, removes the turtle from the alive list, and republishes the updated list.</li>
<li>The process repeats as new turtles continue spawning.</li>
</ol>
<p>This sequence directly reflects the intended integration of topics + services + custom interfaces described in the activity.</p>
<hr />
<h2 id="10-useful-commands-from-assignment-workflow">10. Useful commands (from assignment workflow)</h2>
<h3 id="101-type-inspection">10.1 Type inspection</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>ros2<span class="w"> </span>topic<span class="w"> </span>list<span class="w"> </span>-t
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>ros2<span class="w"> </span>service<span class="w"> </span>list<span class="w"> </span>-t
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>ros2<span class="w"> </span>action<span class="w"> </span>list<span class="w"> </span>-t
</span></code></pre></div>
<p>These commands help verify that:
- the expected topics/services exist
- the interface types match the implementation</p>
<h3 id="102-interface-structure-inspection">10.2 Interface structure inspection</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>er_interfaces_turtle/msg/TurtleIn
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>er_interfaces_turtle/msg/TurtleArray
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>er_interfaces_turtle/srv/CatchTurtle
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>turtlesim/srv/Spawn
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>turtlesim/srv/Kill
</span></code></pre></div>
<p>These commands are especially useful during documentation and debugging because they confirm the exact fields used by the messages/services.</p>
<h3 id="103-verbose-connection-info">10.3 Verbose connection info</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ros2<span class="w"> </span>topic<span class="w"> </span>info<span class="w"> </span>/alive_turtles<span class="w"> </span>-v
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>ros2<span class="w"> </span>topic<span class="w"> </span>info<span class="w"> </span>/turtle1/pose<span class="w"> </span>-v
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>ros2<span class="w"> </span>topic<span class="w"> </span>info<span class="w"> </span>/turtle1/cmd_vel<span class="w"> </span>-v
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>ros2<span class="w"> </span>service<span class="w"> </span>info<span class="w"> </span>/catch_turtle<span class="w"> </span>-v
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>ros2<span class="w"> </span>service<span class="w"> </span>info<span class="w"> </span>/spawn<span class="w"> </span>-v
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>ros2<span class="w"> </span>service<span class="w"> </span>info<span class="w"> </span>/kill<span class="w"> </span>-v
</span></code></pre></div>
<p>Use these commands to validate publishers/subscribers and service clients/servers, which is very helpful to demonstrate that the final graph matches the project architecture.</p>
<hr />
<h2 id="11-terminal-and-results">11. Terminal and results</h2>
<p>Video of each node working toguether
<a href="../recursos/imgs/Act_turtle/resultado.mp4">Demo video</a></p>
<p>Image of launch .xml file result
<img alt="Terminal screenshot" src="../recursos/imgs/Act_turtle/resultado.jpg" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.tooltips"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>